<style>
.seq{
  font-family: monospace;
  font-size: 30px;
}
.seqbox {
  box-sizing: border-box;
  white-space: pre-wrap;
  word-wrap: break-word;
  color: blue;
  font-size: 34px;
  overflow: hidden;
  display: block;
  height: 18em !important;
}
.highlight {
  font-size: 52px;
  transition: font-size 3s ease-in-out, color 3s ease-in-out;
  color: #ff4949;
}
</style>

## {#genome-sequence-slide0 background-color="white"}

<span id="seqSlide" class="seq">
<p>Number of letters: <span id="letterCount">1</span></p>
<p>Possible combinations: <span id="combinations">4</span></p>
<span id="text-box" class="seqbox">
<span id="sequenceDisplay"></span>
</span>
</span>

::: {.fragment id="seqslides1"} 
:::

::: {.fragment id="seqslides2"} 
:::

::: {.fragment id="seqslides3"} 
:::

::: {.fragment id="seqslides4"} 
:::

<script>
document.addEventListener("DOMContentLoaded", function(event) {
  
  const seq = 'ggtggaggttgcagtgagccaagatcatgccactgcactccaccctgggtgacagaacaagactctgtccccaccaaaaagaaaaaatgtaaatgaaaaggaaagatctgccaggccatagctccttgcttcccaggccacattccagggaggccaggagaggcccagagaccagtctaaccgaggtccaggcagcccagagcacgaaggctggtggagagctggccacgtgtcctgagctacggtcagtcagaaggctgaaggtgagtcatcccagacaccgtgctcagtgccaggcccatcagaggccctgggcaggaacagcagcactcagtaacaatggggacactttaccacccttaccctggaagggcctcagaagcactctctccaggctcgacttgcctaagctaggaatcagatctgcagaaacccaagtcccatagcgtgtgctgggtagagccgcctactcctcgtggggcctttgagcaggcagacagctctctgttggggatcacaag';
  let sequenceDisplay = document.getElementById("sequenceDisplay");
  let letterCountDisplay = document.getElementById("letterCount");
  let combinationsDisplay = document.getElementById("combinations"); 

  function showSequence(index=3){
    //sequenceDisplay.textContent += seq.charAt(index);
    sequenceDisplay.textContent = seq.substring(0, index + 1);
    letterCountDisplay.textContent = index + 1;
    combinationsDisplay.textContent = Math.pow(4, index + 1);
  };

  let sequenceInterval = null;
  let isGeneratingSequence = false;
  let stopSequence = false; // New flag to stop the sequence generation

  function startGeneratingSequence() {
    if (isGeneratingSequence) {
      return; // Exit if the sequence is already running
    }
    isGeneratingSequence = true;
    stopSequence = false; // Reset stop flag when starting the sequence
    let index = 0;

    function showNext() {
      if (stopSequence || index >= seq.length) {
        isGeneratingSequence = false;
        return; // Stop generating sequence if flag is set or sequence is complete
      }
      showSequence(index);
      let delay = index <= 0 ? 0 : index <= 3 ? 900 : index <= 20 ? 600 : index <= 50 ? 50 : 10;
      index++;
      setTimeout(showNext, delay);
    }

    showNext();
  }

  function highlight_variant(pos=200) {
    let spanId = 'highlight_base' + pos;
    let modifiedContent = seq.substring(0, pos) + 
                          '<span id="' + spanId + '">' + seq.charAt(pos) + '</span>' + 
                          seq.substring(pos + 1);
    sequenceDisplay.innerHTML = modifiedContent;
    setTimeout(() => {
        document.getElementById(spanId).classList.add("highlight");
    }, 100);
  }

  function unhighlight_variant(pos=200){
    let spanId = 'highlight_base' + pos;
    setTimeout(() => {
      document.getElementById(spanId).classList.remove("highlight");
    }, 100);
  }

  function switch_variant(pos=200,to="t"){
        let spanId = 'highlight_base' + pos;
        document.getElementById(spanId).innerHTML = to;
      }

  function stopSequenceGeneration() {
    if (sequenceInterval) {
      clearTimeout(sequenceInterval);
      sequenceInterval = null;
    }
    isGeneratingSequence = false;
    stopSequence = true; // This will stop future timeouts in the sequence generator
  }


  Reveal.on('fragmentshown', event => {
      if (event.fragment.id === 'seqslides1') {
          console.log("show1");
          showSequence(0);
      } if (event.fragment.id === 'seqslides2') {
          console.log("generate seq");
          startGeneratingSequence();
      } else if (event.fragment.id === 'seqslides3') {
          stopSequenceGeneration();
          console.log("highlight");
          highlight_variant(200);
      } else if (event.fragment.id === 'seqslides4') {
          console.log("switch");
          switch_variant(200, "t");
      }
  });

  Reveal.on('fragmenthidden', event => {
    console.log("fragmenthidden");
    if (event.fragment.id === 'seqslides1') {
        console.log("hide1");
        stopSequenceGeneration();
    } if (event.fragment.id === 'seqslides2') {
        console.log("hide generate seq");
        stopSequenceGeneration();
        showSequence(0);
    } else if (event.fragment.id === 'seqslides3') {
        console.log("hide highlight");
        stopSequenceGeneration();
        unhighlight_variant(200);
    } else if (event.fragment.id === 'seqslides4') {
        console.log("hide switch");
        stopSequenceGeneration();
        switch_variant(200, "a");
    }
  });


});
</script>


<!--

# IFNB1
21,619,700 bp to 21,620,300 bp on Chromosome 9.

# IFNA10
chr9:21,206,100-21,206,700
9:21,206,606 our variant
http://genome.ucsc.edu/cgi-bin/das/hg19/dna?segment=chr9:21206100,21206700


...181 = TSS
...515 conservation with chicken
...525 = Exon start
...606

Covid results (Kousathanas)
chr:pos (hg38)  rsid  REF ALT OR  OR\_CI  Pval  OR\_{hgi.23m} OR\_{CI}\_{hgi.23m} Pval\_{hgi.23m} Gene  Citation
9:21206606  rs28368148  C G 1.74  1.45-2.1  4.09$\times10^{-9}$ 1.21  1.07-1.37 0.00243 \textit{IFNA10} .
<SEQUENCE id="chr9" start="21206100" stop="21206700" version="1.00">
<DNA length="601"> taaatcatctatttttaagtcaggttgtaaagtcagccttggcattttat cttaaagaataaacaaacacaagaaattttgtatagtaaaaatttaatga aaaaggaaattaatatattggctaaatatgaagaacatatattgttacat taaccacaatgtaaagcgactcatgatattacataaattttaaaaataat taaataaatatttaaacaaaagatgaacagagacatcagaatggtcatct gtaaaggactagtgcctgcacaggtatacacgacacttctttacactgct gaaaacatttgaaaattttgattcaacgcgtcgtggttatagaagtgagt ctttgaaatggaagaactcatgaaagtgtgagataatgtattagtcaatc aggatcattgccatgttgaaccagttttcaatccttcctccttaatcttt tttgcaagtttgttgaaaacgagagggatctcatgatttctgctctgaca acctcccaggcacaagggctgtatttcctctctattagataaagagtgat tctttggaagtatttcctcacagccaggatggagtcctcattcatcaggg g </DNA>
</SEQUENCE>



# TYK2
TSS UCSC: 10350532
Seq:
chr19:10350332-10350932

TYK2 SNP IN GWAS 1:
chr19:10317044
http://genome.ucsc.edu/cgi-bin/das/hg19/dna?segment=chr19:10316844,10317324
Position 200 should change


<DASDNA>
<SEQUENCE id="chr19" start="10316844" stop="10317364" version="1.00">
<DNA length="521"> ggtggaggttgcagtgagccaagatcatgccactgcactccaccctgggt gacagaacaagactctgtccccaccaaaaagaaaaaatgtaaatgaaaag gaaagatctgccaggccatagctccttgcttcccaggccacattccaggg aggccaggagaggcccagagaccagtctaaccgaggtccaggcagcccag agcacgaaggctggtggagagctggccacgtgtcctgagctacggtcagt cagaaggctgaaggtgagtcatcccagacaccgtgctcagtgccaggccc atcagaggccctgggcaggaacagcagcactcagtaacaatggggacact ttaccacccttaccctggaagggcctcagaagcactctctccaggctcga cttgcctaagctaggaatcagatctgcagaaacccaagtcccatagcgtg tgctgggtagagccgcctactcctcgtggggcctttgagcaggcagacag ctctctgttggggatcacaag </DNA>
</SEQUENCE>
</DASDNA>




-->